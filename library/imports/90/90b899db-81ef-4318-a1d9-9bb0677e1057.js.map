{"version":3,"sources":["../../../../../assets/scripts/tools/assets/scripts/tools/rockerTool.js"],"names":["rockerType","cc","Enum","Four_Orientation","Eight_Orientation","All_Orientation","Class","extends","Component","properties","orientationType","type","default","displayName","front","Sprite","background","panel","Layout","speed","Float","bodyObj","Node","onLoad","angle","panelNode","node","frontNode","backgroundNode","on","EventType","TOUCH_MOVE","onMove","TOUCH_CANCEL","onEnd","TOUCH_END","event","pos","convertToNodeSpaceAR","getLocation","radius","Math","sqrt","pow","x","y","width","setPosition","posX","cos","atan2","posY","sin","PI","update","fourOrientationExcute","eightOrientationExcute","allOrientationExcute"],"mappings":"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","file":"rockerTool.js","sourceRoot":"../../../../../assets/scripts/tools","sourcesContent":["var rockerType = cc.Enum({\n    Four_Orientation  : 0,\n    Eight_Orientation : 1,\n    All_Orientation   : 2,\n});\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        orientationType: {\n            type: rockerType,\n            default: 0,\n            displayName: \"模式选择\",\n        },\n        front : {\n            type: cc.Sprite,\n            default: null,\n            displayName: \"摇杆内圈\",\n        },\n        background : {\n            type: cc.Sprite,\n            default: null,\n            displayName: \"摇杆外圈\",\n        },\n        panel: {\n            type: cc.Layout,\n            default: null,\n            displayName: \"触摸层\",\n        },\n        speed: {\n            type: cc.Float,\n            default : 0,\n            displayName: \"移动速度\",\n        },\n        bodyObj: {                         \n            type: cc.Node,\n            default: null,\n            displayName: \"控制的物体\",\n        },\n    },\n\n    onLoad () {\n        this.angle = 0;\n        this.panelNode = this.panel.node;\n        this.frontNode = this.front.node;\n        this.backgroundNode = this.background.node;\n        \n        this.panelNode.on(cc.Node.EventType.TOUCH_MOVE, this.onMove, this);\n        this.panelNode.on(cc.Node.EventType.TOUCH_CANCEL, this.onEnd, this);\n        this.panelNode.on(cc.Node.EventType.TOUCH_END, this.onEnd, this);\n    },\n\n    onMove : function(event) {\n        //摇杆跟随逻辑\n        let pos = this.panelNode.convertToNodeSpaceAR(event.getLocation()); \n        let radius = Math.sqrt(Math.pow(pos.x,2) + Math.pow(pos.y,2));\n        if(radius <= this.backgroundNode.width/2) {\n            this.frontNode.setPosition(pos);\n        } else {\n            let posX = Math.cos(Math.atan2(pos.y,pos.x)) * (this.backgroundNode.width/2); \n            let posY = Math.sin(Math.atan2(pos.y,pos.x)) * (this.backgroundNode.width/2); \n            this.frontNode.setPosition(posX,posY);\n        }\n        //方向计算逻辑\n        this.angle = Math.atan2(pos.y,pos.x) * (180 / Math.PI);\n    },\n\n    onEnd : function (event) {\n        this.frontNode.setPosition(0,0);\n        this.angle = 0;\n    },\n\n    update () {\n        switch(this.orientationType) {\n            case 0:\n                this.fourOrientationExcute(this.angle);\n                break;\n            case 1:\n                this.eightOrientationExcute(this.angle);\n                break;\n            case 2:\n                this.allOrientationExcute(this.angle);\n                break;\n            default:\n                break;\n        }\n    },\n\n    fourOrientationExcute : function ()\n    {\n        if (this.angle > 45 && this.angle < 135) {                                              //上\n            this.bodyObj.y += this.speed;\n        } else if (this.angle > -135 && this.angle < -45) {                                     //下\n            this.bodyObj.y -= this.speed;\n        } else if (this.angle < -135 && this.angle > -180 || this.angle > 135 && this.angle < 180) {      //左\n            this.bodyObj.x -= this.speed;\n        } else if (this.angle < 0 && this.angle > -45 || this.angle > 0 && this.angle < 45) {             //右\n            this.bodyObj.x += this.speed;\n        }  \n    },\n\n    allOrientationExcute: function () {  \n        if(this.angle === 0) { return; }\n        this.bodyObj.x += Math.cos(this.angle * (Math.PI / 180)) * this.speed;  \n        this.bodyObj.y += Math.sin(this.angle * (Math.PI / 180)) * this.speed;  \n    }, \n\n    eightOrientationExcute: function () { \n        if (this.angle > 67.5 && this.angle < 112.5) {  \n            this.bodyObj.y += this.speed;  \n        } else if (this.angle > -112.5 && this.angle < -67.5) {  \n            this.bodyObj.y -= this.speed;  \n        } else if (this.angle < -157.5 && this.angle > -180 || this.angle > 157.5 && this.angle < 180) {  \n            this.bodyObj.x -= this.speed;  \n        } else if (this.angle < 0 && this.angle > -22.5 || this.angle > 0 && this.angle < 22.5) {  \n            this.bodyObj.x += this.speed;  \n        } else if (this.angle > 112.5 && this.angle < 157.5) {  \n            this.bodyObj.x -= this.speed / 1.414;  \n            this.bodyObj.y += this.speed / 1.414;  \n        } else if (this.angle > 22.5 && this.angle < 67.5) {  \n            this.bodyObj.x += this.speed / 1.414;  \n            this.bodyObj.y += this.speed / 1.414;  \n        } else if (this.angle > -157.5 && this.angle < -112.5) {  \n            this.bodyObj.x -= this.speed / 1.414;  \n            this.bodyObj.y -= this.speed / 1.414;  \n        } else if (this.angle > -67.5 && this.angle < -22.5) {  \n            this.bodyObj.x += this.speed / 1.414;  \n            this.bodyObj.y -= this.speed / 1.414;  \n        }  \n    },\n});\n"]}